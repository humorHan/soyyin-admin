webpackJsonp([10],{70:function(t,e,n){var i,a;n(71),i=n(73),a=n(74),t.exports=i||{},t.exports.__esModule&&(t.exports=t.exports.default),a&&(("function"==typeof t.exports?t.exports.options:t.exports).template=a)},71:function(t,e,n){var i=n(72);"string"==typeof i&&(i=[[t.id,i,""]]);n(40)(i,{});i.locals&&(t.exports=i.locals)},72:function(t,e,n){e=t.exports=n(39)(),e.push([t.id,".modal[_v-93eabb2e]{height:100%}.modal-dialog[_v-93eabb2e]{top:30%}","",{version:3,sources:["/./src/components/popupDialog.vue.style"],names:[],mappings:"AAwDA,oBACA,WAAA,CACA,AAEA,2BACA,OAAA,CACA",file:"popupDialog.vue",sourcesContent:['<!-- popupDialog.vue -->\n<template>\n    <div class="modal" v-show="showDialog">\n        <div class="modal-dialog">\n            <div class="modal-content">\n                <div class="modal-header">\n                    <button type="button" class="close" @click="closeDialog">&times;</button>\n                    <h4 class="modal-title">{{ dialogTitle }}</h4>\n                </div>\n                <div class="modal-body">\n                    <p>{{ dialogContent }}</p>\n                </div>\n                <div class="modal-footer">\n                    <button type="button" class="btn btn-default" @click="clickNegativeButton">{{ negativeButtonText }}</button>\n        \t\t\t<button type="button" class="btn btn-primary" @click="clickPositiveButton">{{ positiveButtonText }}</button>\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\n\nexport default {\n    name: \'PopupDialogView\',\n    props: {\n    \tshowDialog: Boolean,\n    \tdialogTitle: String,\n    \tdialogContent: String,\n    \tnegativeButtonText: {\n    \t\ttype: String,\n    \t\tdefault: \'取消\'\n    \t},\n    \tpositiveButtonText: {\n    \t\ttype: String,\n    \t\tdefault: \'确定\'\n    \t},\n    },\n    methods: {\n    \tcloseDialog(event) {\n    \t\tthis.showDialog = false;\n    \t},\n    \tclickPositiveButton(event) {\n    \t\tthis.showDialog = false;\n    \t\tthis.$dispatch(\'click-positive-button\');\n    \t},\n    \tclickNegativeButton(event) {\n    \t\tthis.showDialog = false;\n    \t\tthis.$dispatch(\'click-negative-button\');\n    \t},\n    },\n}\n\n</script>\n\n<style scoped>\n.modal {\n\theight: 100%;\n}\n\n.modal-dialog {\n\ttop: 30%;\n}\n\n</style>'],sourceRoot:"webpack://"}])},73:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"PopupDialogView",props:{showDialog:Boolean,dialogTitle:String,dialogContent:String,negativeButtonText:{type:String,default:"取消"},positiveButtonText:{type:String,default:"确定"}},methods:{closeDialog:function(t){this.showDialog=!1},clickPositiveButton:function(t){this.showDialog=!1,this.$dispatch("click-positive-button")},clickNegativeButton:function(t){this.showDialog=!1,this.$dispatch("click-negative-button")}}}},74:function(t,e){t.exports=' <div class=modal v-show=showDialog _v-93eabb2e=""> <div class=modal-dialog _v-93eabb2e=""> <div class=modal-content _v-93eabb2e=""> <div class=modal-header _v-93eabb2e=""> <button type=button class=close @click=closeDialog _v-93eabb2e="">×</button> <h4 class=modal-title _v-93eabb2e="">{{ dialogTitle }}</h4> </div> <div class=modal-body _v-93eabb2e=""> <p _v-93eabb2e="">{{ dialogContent }}</p> </div> <div class=modal-footer _v-93eabb2e=""> <button type=button class="btn btn-default" @click=clickNegativeButton _v-93eabb2e="">{{ negativeButtonText }}</button> <button type=button class="btn btn-primary" @click=clickPositiveButton _v-93eabb2e="">{{ positiveButtonText }}</button> </div> </div> </div> </div> '},199:function(t,e,n){var i,a;n(200),i=n(202),a=n(203),t.exports=i||{},t.exports.__esModule&&(t.exports=t.exports.default),a&&(("function"==typeof t.exports?t.exports.options:t.exports).template=a)},200:function(t,e,n){var i=n(201);"string"==typeof i&&(i=[[t.id,i,""]]);n(40)(i,{});i.locals&&(t.exports=i.locals)},201:function(t,e,n){e=t.exports=n(39)(),e.push([t.id,".nav-pills>li>a[_v-37c36e72]{cursor:pointer}.refunds-table[_v-37c36e72]{table-layout:fixed}.refunds-table td[_v-37c36e72],.refunds-table th[_v-37c36e72]{text-align:center;vertical-align:middle}.refunds-table td .btn-link[_v-37c36e72]{text-decoration:none;cursor:pointer}.refunds-table td .btn-link[_v-37c36e72]:hover{text-decoration:underline}","",{version:3,sources:["/./src/views/finance/refunds.vue.style"],names:[],mappings:"AAqKA,6BACA,cAAA,CACA,AAEA,4BACA,kBAAA,CACA,AAEA,8DACA,kBAAA,AACA,qBAAA,CACA,AAEA,yCACA,qBAAA,AACA,cAAA,CACA,AAEA,+CACA,yBAAA,CACA",file:"refunds.vue",sourcesContent:['<!-- refunds.vue -->\n<template>\n    <div class="container-fluid">\n        <ul class="breadcrumb">\n            <li>财务系统</li>\n            <li>退款管理</li>\n        </ul>\n        <ul class="nav nav-pills">\n            <li :class="{\'active\': type === \'WAITING\'}" v-if="permissionList.view"><a @click="getList(\'WAITING\')">待退款</a></li>\n            <li :class="{\'active\': type === \'ALL\'}" v-if="permissionList.view"><a @click="getList(\'ALL\')">全部</a></li>\n        </ul>\n        <p class="clearfix"></p>\n        <table class="table table-bordered table-hover refunds-table">\n            <thead>\n                <tr>\n                    <th style="width:6%;">ID</th>\n                    <th style="width:10%;">订单ID</th>\n                    <th style="width:8%;">退款金额</th>\n                    <th style="width:22%;">退款类型/信息</th>\n                    <th style="width:16%;">退款原因</th>\n                    <th style="width:10%;">状态</th>\n                    <th style="width:19%;">操作信息</th>\n                    <th style="width:9%;">操作</th>\n                </tr>\n            </thead>\n            <tbody>\n                <tr v-for="refundItem of refundList">\n                    <td>{{refundItem.id}}</td>\n                    <td><a class="btn-link" v-link="{path:\'/order/detail/\' + refundItem.order_id}" target="_blank">{{refundItem.order_id}}</a></td>\n                    <td>{{refundItem.amount | realPrice}}元</td>\n                    <td>\n                        类型：{{refundItem.type | refundTypeFilter}}<br>\n                        退款渠道：{{refundItem.method | refundWayFilter}}<br>\n                        <template v-if="refundItem.type === \'BY_HAND\'">\n                            对方账号：{{refundItem.account}}<br>\n                            对方姓名：{{refundItem.name}}<br>\n                        </template>\n                    </td>\n                    <td>{{refundItem.reason}}</td>\n                    <td :class="{\'text-success\': refundItem.status === \'FINISHED\'}">{{refundItem.status | refundStatusFilter}}</td>\n                    <td>\n                        创建时间：{{refundItem.create_time | dateFormat}}<br>\n                        <template v-if="refundItem.finish_time">\n                            完成时间：{{refundItem.finish_time | dateFormat}}<br>\n                        </template>\n                    </td>\n                    <td>\n                        <template v-if="refundItem.type === \'BY_HAND\'">\n                            <a class="btn btn-info btn-sm" v-if="refundItem.status === \'WAITING\' && permissionList.finishRefund" @click="showFinishRefundDialog(refundItem)">退款完成</a>\n                        </template>\n                        <template v-else>\n                            <a class="btn btn-info btn-sm" v-if="refundItem.pingxx_method === \'ALIPAY_PC\' && refundItem.status !== \'FINISHED\' && permissionList.finishRefund" @click="jumpToZhifubaoRefundLink(refundItem)">去退款</a>\n                        </template>\n                    </td>\n                </tr>\n            </tbody>\n        </table>\n        <a class="btn btn-primary" v-if="sinceId" @click="getList(type, sinceId)">查看更多</a>\n        <popup-dialog :show-dialog.sync="dataForPopupDialog.show" :dialog-title="dataForPopupDialog.title" :dialog-content="dataForPopupDialog.content"></popup-dialog>\n    </div>\n</template>\n\n<script>\nimport popupDialog from \'../../components/popupDialog.vue\'\nimport { callback } from \'../../store\'\nimport { unique } from \'../../filters\'\nimport { permissionValidator } from \'../../store/rolePermission.js\'\n\nconst FINISH_REFUND = "FINISH_REFUND";\n\nexport default {\n    name: \'FinanceRefundsView\',\n    components: {\n        popupDialog,\n    },\n    data() {\n        return {\n            type: \'\',\n            sinceId: \'\',\n            refundList: [],\n            permissionList: {\n                view: permissionValidator.financeSystem.refund.view(),\n                finishRefund: permissionValidator.financeSystem.refund.finishRefund(),\n            },\n            dataForPopupDialog: {\n                show: false,\n                title: \'完成确认\',\n                content: \'\',\n            },\n        }\n    },\n    ready() {\n        if (this.permissionList.view) {\n            this.getList(\'WAITING\');\n        }\n    },\n    events: {\n        \'click-positive-button\'() {\n            if (this.dataForPopupDialog.dialogId === FINISH_REFUND) {\n                this.finishRefund(this.dataForPopupDialog.passingData);\n            }\n        },\n    },\n    methods: {\n        getList(type, sinceId) {\n            this.type = type;\n            var url = \'/api/v2/admin/refunds/list?type=\' + type;\n            if(sinceId){\n                url += \'&since_id=\' + sinceId;\n            }\n            this.$http.get(url)\n            .then((response) => {\n                if (!response.data.result || response.data.result === 0) {\n                    var arr = [];\n                    if (sinceId) {\n                        arr = this.refundList.concat(response.data.refunds);\n                    } else {\n                        arr = response.data.refunds;\n                    }\n                    this.refundList = unique(arr);\n                    this.$set("sinceId", response.data.since_id || \'\');\n                } else {\n                    callback.success(response.data);\n                }\n            },(response) => {\n                callback.error(response);\n            })\n        },\n        showFinishRefundDialog(refundItem) {\n            this.dataForPopupDialog.show = true;\n            this.dataForPopupDialog.content = "确定完成退款？";\n            this.dataForPopupDialog.dialogId = FINISH_REFUND;\n            this.dataForPopupDialog.passingData = refundItem;\n        },\n        finishRefund(refundItem) {\n            var url = \'/api/v2/admin/refunds/complete?refund_id=\' + refundItem.id;\n            this.$http.put(url)\n            .then((response) => {\n                if (!response.data.result || response.data.result === 0) {\n                    location.reload();\n                } else {\n                    callback.success(response.data);\n                }\n            },(response) => {\n                callback.error(response);\n            });\n        },\n        jumpToZhifubaoRefundLink(refundItem) {\n            var url = \'/api/v2/admin/refunds/alipay-url?refund_id=\' + refundItem.id;\n            this.$http.get(url)\n            .then((response) => {\n                if (!response.data.result || response.data.result === 0) {\n                    window.open(response.data.url);\n                } else {\n                    callback.success(response.data);\n                }\n            },(response) => {\n                callback.error(response);\n            });\n        },\n    },\n}\n</script>\n\n<style scoped>\n.nav-pills > li > a{\n    cursor: pointer;\n}\n\n.refunds-table {\n    table-layout: fixed;\n}\n\n.refunds-table th, .refunds-table td{\n    text-align: center;\n    vertical-align: middle;\n}\n\n.refunds-table td .btn-link {\n    text-decoration: none;\n    cursor: pointer;\n}\n\n.refunds-table td .btn-link:hover {\n    text-decoration: underline;\n}\n</style>'],sourceRoot:"webpack://"}])},202:function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(70),s=i(a),o=n(46),l=n(29),d=n(43),r="FINISH_REFUND";e.default={name:"FinanceRefundsView",components:{popupDialog:s.default},data:function(){return{type:"",sinceId:"",refundList:[],permissionList:{view:d.permissionValidator.financeSystem.refund.view(),finishRefund:d.permissionValidator.financeSystem.refund.finishRefund()},dataForPopupDialog:{show:!1,title:"完成确认",content:""}}},ready:function(){this.permissionList.view&&this.getList("WAITING")},events:{"click-positive-button":function(){this.dataForPopupDialog.dialogId===r&&this.finishRefund(this.dataForPopupDialog.passingData)}},methods:{getList:function(t,e){var n=this;this.type=t;var i="/api/v2/admin/refunds/list?type="+t;e&&(i+="&since_id="+e),this.$http.get(i).then(function(t){if(t.data.result&&0!==t.data.result)o.callback.success(t.data);else{var i=[];i=e?n.refundList.concat(t.data.refunds):t.data.refunds,n.refundList=(0,l.unique)(i),n.$set("sinceId",t.data.since_id||"")}},function(t){o.callback.error(t)})},showFinishRefundDialog:function(t){this.dataForPopupDialog.show=!0,this.dataForPopupDialog.content="确定完成退款？",this.dataForPopupDialog.dialogId=r,this.dataForPopupDialog.passingData=t},finishRefund:function(t){var e="/api/v2/admin/refunds/complete?refund_id="+t.id;this.$http.put(e).then(function(t){t.data.result&&0!==t.data.result?o.callback.success(t.data):location.reload()},function(t){o.callback.error(t)})},jumpToZhifubaoRefundLink:function(t){var e="/api/v2/admin/refunds/alipay-url?refund_id="+t.id;this.$http.get(e).then(function(t){t.data.result&&0!==t.data.result?o.callback.success(t.data):window.open(t.data.url)},function(t){o.callback.error(t)})}}}},203:function(t,e){t.exports=' <div class=container-fluid _v-37c36e72=""> <ul class=breadcrumb _v-37c36e72=""> <li _v-37c36e72="">财务系统</li> <li _v-37c36e72="">退款管理</li> </ul> <ul class="nav nav-pills" _v-37c36e72=""> <li :class="{\'active\': type === \'WAITING\'}" v-if=permissionList.view _v-37c36e72=""><a @click="getList(\'WAITING\')" _v-37c36e72="">待退款</a></li> <li :class="{\'active\': type === \'ALL\'}" v-if=permissionList.view _v-37c36e72=""><a @click="getList(\'ALL\')" _v-37c36e72="">全部</a></li> </ul> <p class=clearfix _v-37c36e72=""></p> <table class="table table-bordered table-hover refunds-table" _v-37c36e72=""> <thead _v-37c36e72=""> <tr _v-37c36e72=""> <th style=width:6% _v-37c36e72="">ID</th> <th style=width:10% _v-37c36e72="">订单ID</th> <th style=width:8% _v-37c36e72="">退款金额</th> <th style=width:22% _v-37c36e72="">退款类型/信息</th> <th style=width:16% _v-37c36e72="">退款原因</th> <th style=width:10% _v-37c36e72="">状态</th> <th style=width:19% _v-37c36e72="">操作信息</th> <th style=width:9% _v-37c36e72="">操作</th> </tr> </thead> <tbody _v-37c36e72=""> <tr v-for="refundItem of refundList" _v-37c36e72=""> <td _v-37c36e72="">{{refundItem.id}}</td> <td _v-37c36e72=""><a class=btn-link v-link="{path:\'/order/detail/\' + refundItem.order_id}" target=_blank _v-37c36e72="">{{refundItem.order_id}}</a></td> <td _v-37c36e72="">{{refundItem.amount | realPrice}}元</td> <td _v-37c36e72=""> 类型：{{refundItem.type | refundTypeFilter}}<br _v-37c36e72=""> 退款渠道：{{refundItem.method | refundWayFilter}}<br _v-37c36e72=""> <template v-if="refundItem.type === \'BY_HAND\'" _v-37c36e72=""> 对方账号：{{refundItem.account}}<br _v-37c36e72=""> 对方姓名：{{refundItem.name}}<br _v-37c36e72=""> </template> </td> <td _v-37c36e72="">{{refundItem.reason}}</td> <td :class="{\'text-success\': refundItem.status === \'FINISHED\'}" _v-37c36e72="">{{refundItem.status | refundStatusFilter}}</td> <td _v-37c36e72=""> 创建时间：{{refundItem.create_time | dateFormat}}<br _v-37c36e72=""> <template v-if=refundItem.finish_time _v-37c36e72=""> 完成时间：{{refundItem.finish_time | dateFormat}}<br _v-37c36e72=""> </template> </td> <td _v-37c36e72=""> <template v-if="refundItem.type === \'BY_HAND\'" _v-37c36e72=""> <a class="btn btn-info btn-sm" v-if="refundItem.status === \'WAITING\' &amp;&amp; permissionList.finishRefund" @click=showFinishRefundDialog(refundItem) _v-37c36e72="">退款完成</a> </template> <template v-else="" _v-37c36e72=""> <a class="btn btn-info btn-sm" v-if="refundItem.pingxx_method === \'ALIPAY_PC\' &amp;&amp; refundItem.status !== \'FINISHED\' &amp;&amp; permissionList.finishRefund" @click=jumpToZhifubaoRefundLink(refundItem) _v-37c36e72="">去退款</a> </template> </td> </tr> </tbody> </table> <a class="btn btn-primary" v-if=sinceId @click="getList(type, sinceId)" _v-37c36e72="">查看更多</a> <popup-dialog :show-dialog.sync=dataForPopupDialog.show :dialog-title=dataForPopupDialog.title :dialog-content=dataForPopupDialog.content _v-37c36e72=""></popup-dialog> </div> '}});
//# sourceMappingURL=10.js.map